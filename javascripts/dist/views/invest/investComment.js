define(["jumi","limit","isLogin","isLoginwx","vue","getPara","scrolltotop","weixin","load"],function(t,e,o,n,i,s,c,a,l){var u=s.get(),m=u.itemid,r=u.commentType.split("#")[0],d=localStorage.getItem("token"),p={};p.currentPage=1,p.pageSize=10;var f={currentPage:1,commentType:r,pageSize:9999,itemId:m,requestSource:"WAP",token:d};$.ajax({url:"/comment/list/v1.0",type:"get",data:f,success:function(s){for(var c=s.data.commentList,l=!!location.href.split("#")[1]&&location.href.split("#")[1].split("d")[1],p=0,f=c.length;p<f;p++)!function(t){var e=c[t].subCommentList.concat();if(e&&e.length>2)for(var o=0;o<e.length;o++)l==c[t].subCommentList[o].id?c[t].isExpand=!0:c[t].isExpand=!1;c[t].subSplice=e.splice(0,2)}(p);new i({el:"body",components:{"my-comment":{template:"#commentTemplate",data:function(){return{userid:s.data.userId,lists:c,isLoading:0,msg:"",subMsg:"",maoz:location.href.split("#")[1]?location.href.split("#")[1].split("d")[1]:"",ctz:r,sendSwitch:!0}},methods:{expandAll:function(t){t.isExpand=!0},foldAll:function(t){t.isExpand=!1},watchProgram:function(){switch(r){case"3":location.assign("/h5/views/invest/invest.html?itemId="+m);break;case"2":location.assign("/h5/views/notice/mediaReport.html?inforId="+m);break;case"1":location.assign("/h5/views/notice/projectDynamics.html?inforId="+m);break;case"0":location.assign("/h5/views/notice/announcement.html?inforId="+m)}},toLogin:function(){o()},sendMsg:function(){var e=this;o(function(){var o={commentType:r,content:e.msg.replace(/<[^>]*>/g,""),itemId:m,parentCommentId:0,parentId:0,requestSource:"WAP",token:d};return""==e.msg?void t.tips("评论不能为空！"):void(e.sendSwitch&&(e.sendSwitch=!1,$.ajax({url:"/comment/reply/v1.0",type:"get",data:{id:0,requestSource:"WAP",token:d},success:function(n){"0000"==n.code?$.ajax({url:"/comment/comment/v1.0",type:"post",dataType:"json",data:o,success:function(o){if("0000"==o.code){if(o.data){var n=o.data;n.isExpand=!1,n.subCommentList&&(n.subSplice=n.subCommentList.concat().splice(0,2)),t.tips("评论成功！"),e.msg="",$("[data-limitnumber]").html(150),e.obj=e.lists,e.obj.unshift(n),e.lists=e.obj,$(window).scrollTop(0),e.sendSwitch=!0}}else t.tips(o.msg),setTimeout(function(){location.reload()},3e3)}}):"8024"==n.code?(t.tips("您的行为存在不安全隐患，已被禁言处理，如需恢复请与客服联系"),setTimeout(function(){location.reload()},3e3)):"8025"==n.code?(t.tips("该评论不存在"),setTimeout(function(){location.reload()},3e3)):t.tips(n.msg)}})))})},replyMain:function(n,i){var s=this;e({dom:"#replyMsg",numDom:null,max:150}),o(function(){$.ajax({url:"/comment/reply/v1.0",type:"get",data:{id:i,requestSource:"WAP",token:d},success:function(e){"0000"==e.code?t.alert({content:document.getElementById("replyMsg"),skin:"ui-dialog-reply",button:[{value:"取消"},{value:"发送",callback:function(){if(""==s.subMsg)return t.tips("不能为空！"),!1;var e={commentType:r,content:s.subMsg.replace(/<[^>]*>/g,""),itemId:m,parentCommentId:i,parentId:i,requestSource:"WAP",toUserId:n,token:d};$.ajax({url:"/comment/comment/v1.0",type:"post",dataType:"json",data:e,success:function(e){if("0000"==e.code){s.obj=s.lists;for(var o=0;o<s.obj.length;o++)i==s.obj[o].id&&(s.obj[o].isExpand=!0,s.obj[o].subCommentList.push(e.data),s.obj[o].subSplice=s.obj[o].subCommentList.concat().splice(0,2));s.subMsg="",s.lists=s.obj}else t.tips(e.msg),setTimeout(function(){location.reload()},3e3)}})}}]}):"8024"==e.code?(t.tips("您的行为存在不安全隐患，已被禁言处理，如需恢复请与客服联系"),setTimeout(function(){location.reload()},3e3)):"8025"==e.code?(t.tips("该评论不存在"),setTimeout(function(){location.reload()},3e3)):t.tips(e.msg)}})})},replySub:function(n,i,s){console.log("replySub");var c=this;e({dom:"#replyMsg",numDom:null,max:150}),o(function(){$.ajax({url:"/comment/reply/v1.0",type:"get",data:{id:i,requestSource:"WAP",token:d},success:function(e){"0000"==e.code?t.alert({content:document.getElementById("replyMsg"),skin:"ui-dialog-reply",button:[{value:"取消"},{value:"发送",callback:function(){if(""==c.subMsg)return t.tips("不能为空！"),!1;var e={commentType:r,content:c.subMsg.replace(/<[^>]*>/g,""),itemId:m,parentCommentId:i,parentId:s,requestSource:"WAP",toUserId:n,token:d};$.ajax({url:"/comment/comment/v1.0",type:"post",dataType:"json",data:e,success:function(e){if("0000"==e.code){c.obj=c.lists;for(var o=0;o<c.obj.length;o++)s==c.obj[o].id&&(c.obj[o].isExpand=!0,c.obj[o].subCommentList.push(e.data),c.obj[o].subSplice=c.obj[o].subCommentList.concat().splice(0,2));c.subMsg="",c.lists=c.obj}else t.tips(e.msg),setTimeout(function(){location.reload()},3e3)}})}}]}):"8024"==e.code?(t.tips("您的行为存在不安全隐患，已被禁言处理，如需恢复请与客服联系"),setTimeout(function(){location.reload()},3e3)):"8025"==e.code?(t.tips("该评论不存在"),setTimeout(function(){location.reload()},3e3)):t.tips(e.msg)}})})},del:function(e){var n=this;o(function(){t.alert({content:"是否确认删除？",button:[{value:"取消"},{value:"确认",callback:function(){$.ajax({url:"/comment/comment/v1.0",type:"post",data:{commentId:e,requestSource:"WAP",token:d,_method:"delete"},success:function(o){if("0000"==o.code){t.tips("删除成功！");for(var i=0;i<n.lists.length;i++)e==n.lists[i].id&&n.lists.splice(i,1)}else t.tips(o.msg),setTimeout(function(){location.reload()},3e3)}})}}]})})},subDel:function(e){o(function(){t.alert({content:"是否确认删除？",button:[{value:"取消"},{value:"确认",callback:function(){$.ajax({url:"/comment/comment/v1.0",type:"post",data:{commentId:e,requestSource:"WAP",token:d,_method:"delete"},success:function(e){"0000"==e.code?(t.tips("删除成功！"),setTimeout(function(){location.reload()},2400)):(t.tips(e.msg),setTimeout(function(){location.reload()},3e3))}})}}]})})}}}},ready:function(){var t=u.commentType.split("#")[1];t&&(window.location.hash="#"+t,window.location=window.location);var o=location.href.split("&code=")[0],i=location.href.split("&code=")[1];if(i){var s=i.split("&state=")[0];n(s,o)}$("#myloading").remove(),setTimeout(function(){window.scrollBy(0,-140)},300),e({dom:"[data-msg]",numDom:"[data-limitnumber]",max:150}),$(function(){$("[data-msg]").on({focusin:function(){$(this).animate({height:"13rem"},200,function(){$(this).css({overflow:"scroll"})})},focusout:function(){$(this).animate({height:"4.2rem"},200,function(){$(this).css({overflow:"scroll"})})}})}),a.setTitle().setDesc().setImg().setUrl().share()}})}})});