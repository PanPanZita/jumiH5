define(["jumi","vue","getPara","api","md5","weixin","dialog"],function(e,t,i,s,o,n,a){var r=i.get();new t({el:"body",components:{"my-register":{template:"#registerTemplate",data:function(){return{phone:"",password:"",phone_code:"",invite_phone:r.invitePhone,isShowHideRegister:!0,isinvitePhone:!0,setIntervalID:"",countTime:60,clickstatus:!0,setIntervalCode:null,isShowHide:!0,flagVoice:!0,itemLabel:r.itemFlag,sliderSuccess:!1}},methods:{toShowHide:function(){var e=/^\S{0}$/,t=/^(13|14|15|16|18|17|19)\d{9}$/,i=/^(?!^[0-9]+$)(?!^[a-zA-Z]+$)[0-9A-Za-z]{6,16}$/,s=e.test(this.phone)||!t.test(this.phone),o=e.test(this.password)||!i.test(this.password);s||o?this.isShowHide=!0:this.isShowHide=!1},toShowHideResiter:function(){var e=/^\S{0}$/,t=/^\S{4}$/,i=/^(13|14|15|16|18|17|19)\d{9}$/,s=/^(?!^[0-9]+$)(?!^[a-zA-Z]+$)[0-9A-Za-z]{6,16}$/,o=e.test(this.phone)||!i.test(this.phone),n=e.test(this.password)||!s.test(this.password),a=e.test(this.phone_code)||!t.test(this.phone_code);o||n||a?this.isShowHideRegister=!0:this.isShowHideRegister=!1},inputPhoneBlur:function(){var t=this,i=this.phone,s=/^\S{0}$/,o=/^(13|14|15|16|18|17|19)\d{9}$/;if(!s.test(i)){if(!o.test(i))return void e.tips("手机号码格式不正确！");var n={phone:this.phone,requestSource:"WAP"};$.ajax({url:"/common/validatePhoneIsExist",type:"post",dataType:"json",data:n,success:function(i){"0000"==i.code?i.data.result&&e.alert({skin:"ui-dialog-bankcard",content:"该手机号码已注册，请直接登录！",button:[{value:"取消",callback:function(){t.phone=""}},{value:"登录",callback:function(){location.href="/h5/views/account/account.html"}}]}):e.tips(i.msg)}})}},inputPhoneKeyup:function(){var t=/^\S{11}$/,i=/^[0-9]*$/;return i.test(this.phone)?(t.test(this.phone)||(this.phone=this.phone.substring(0,11)),this.toShowHide(),void this.toShowHideResiter()):void e.tips("手机号码格式不正确！")},inputPasswordBlur:function(){var t=/^\S{0}$/,i=/^(?!^[0-9]+$)(?!^[a-zA-Z]+$)[0-9A-Za-z]{6,16}$/;if(!t.test(this.password))return i.test(this.password)?void 0:void e.tips("密码应为6-16位字母和数字组合")},inputPasswordKeyup:function(){var e=/^\S{0}$/,t=/^\S{6,16}$/;e.test(this.password)||(t.test(this.password)||(this.password=this.password.substring(0,16)),this.toShowHide(),this.toShowHideResiter())},inputCodeKeyup:function(){var e=/^\S{0}$/,t=/^\S{4}$/;e.test(this.phone_code)||(t.test(this.phone_code)||(this.phone_code=this.phone_code.substring(0,4)),this.toShowHideResiter())},inputInvitePhone:function(){var t=this,i=t.invite_phone,s=/^\S{0}$/,o=/^(13|14|15|16|18|17|19)\d{9}$/,n=/^[0-9]*$/;if(s.test(i))return void(t.isinvitePhone=!0);if(!n.test(i))return void e.tips("手机号码格式不正确！");if(!o.test(i))return e.tips("手机号码格式不正确！"),void(t.isinvitePhone=!1);var a={phone:t.invite_phone,requestSource:"WAP"};$.ajax({url:"/common/validatePhoneIsExist",type:"post",dataType:"json",data:a,success:function(i){if("0000"===i.code){if(!i.data.result)return t.isinvitePhone=!1,void e.tips("邀请人不存在！")}else e.tips(i.msg)}})},inputInvitePhoneKeyup:function(){var t=/^\S{11}$/,i=/^[0-9]*$/;return i.test(this.invite_phone)?void(t.test(this.invite_phone)||(this.invite_phone=this.invite_phone.substring(0,11))):void e.tips("手机号码格式不正确！")},protocols:function(){var t=$("#protocolBox").children().length;t?e.alert({title:"聚米众筹用户注册服务协议",content:$("#protocolBox").html(),button:[{value:"知道了"}]}):$("#protocolBox").load("/h5/views/common/protocols.html",function(){e.alert({title:"聚米众筹用户注册服务协议",content:$("#protocolBox").html(),button:[{value:"知道了"}]})})},getCode:function(){var t=this;$(".getVoicecode").removeAttr("disabled"),$(".getVoicecode").removeClass("disabled");var i=["FFFF0N00000000005AD9",(new Date).getTime(),Math.random()].join(":"),s=NoCaptcha.init({renderTo:"#sliderNc",appkey:"FFFF0N00000000005AD9",scene:"nc_register_h5",token:i,trans:{key1:"code0"},elementID:["usernameID"],is_Opt:0,language:"cn",timeout:1e4,retryTimes:5,errorTimes:5,inline:!1,apimap:{},bannerHidden:!0,initHidden:!0,callback:function(s){var o={phone:t.phone,scence:"nc_register_h5",sessionId:s.csessionid,sig:s.sig,token:i};$.ajax({url:"/common/authcode/slidValidate",type:"post",datatype:"json",data:o,success:function(i){"0000"==i.code?(e.tips("验证码发送成功，请注意查收..."),clearInterval(t.setIntervalCode),t.sliderSuccess=!0,$(".getCode").attr("disabled","disabled"),$(".getCode").addClass("disabled"),t.setIntervalCode=setInterval(function(){t.countTime--,$(".getCode").html(t.countTime+"s"),t.countTime<=0&&(clearInterval(t.setIntervalCode),t.sliderSuccess=!1,t.countTime=60,$(".getCode").html("重新获取"),$(".getCode").removeAttr("disabled"),$(".getCode").removeClass("disabled"))},1e3)):e.tips(i.msg)}})},error:function(e){}});NoCaptcha.setEnabled(!0),s.reset(),NoCaptcha.upLang("cn",{LOADING:"加载中...",SLIDER_LABEL:"请按住滑块，拖动到最右边",CHECK_Y:"验证通过",ERROR_TITLE:"非常抱歉，这出错了...",CHECK_N:"验证未通过",OVERLAY_INFORM:"经检测你当前操作环境存在风险，请输入验证码",TIPS_TITLE:"验证码错误，请重新输入"}),s.show(),$(".getCode").attr("disabled","disabled"),$(".getCode").addClass("disabled")},ok:function(){var t=this;if(t.clickstatus){t.clickstatus=!1;var i={sourceType:1,registerPhone:t.phone,password:o(t.password).toLocaleUpperCase(),phoneCode:t.phone_code,invitePhone:t.invite_phone,itemLabel:t.itemLabel,requestSource:"WAP"};if(t.isinvitePhone){var s=(new Date).getTime();i.timeToken=s,$.ajax({url:"/register/shareRegister",type:"post",dataType:"json",data:i,success:function(i){"0000"===i.code?(sessionStorage.setItem("token",i.data.token),e.alert({skin:"ui-dialog-bankcard",content:'<p style="text-align:center">注册成功！</p><p class="clr-gray font-12" style="text-align:center;margin-top:0.5rem">为了您的账户安全，请完成实名认证</p>',button:[{value:"首页",callback:function(){location.href="/h5/views/main/index.html"}},{value:"去开户",callback:function(){location.href="/h5/views/account/settings/bankcardToBind.html?redirectURL=/h5/views/main/index.html"}}]})):(e.tips(i.msg),t.clickstatus=!0)}})}}},getVoicecode:function(){var t=this;if(t.flagVoice){var i={phone:t.phone,requestSource:"WAP"};t.flagVoice=!1,$.ajax({url:"/common/authcode/voiceCode",type:"get",datatype:"json",data:i,success:function(i){"0000"==i.code?e.tips("语音验证码发送成功，请注意接听来电..."):e.tips(i.msg),setTimeout(function(){t.flagVoice=!0},5e3)}})}},countdown:function(){var e=this;clearInterval(e.setIntervalID);var t=$("#getCodeButtonMask"),i=60;t.addClass("disabled"),e.setIntervalID=setInterval(function(){i--,t.html("获取验证码（"+i+"）"),0==i&&(clearInterval(e.setIntervalID),i=60,t.removeClass("disabled").html("获取验证码"),LUOCAPTCHA.reset())},1e3)}}}},ready:function(){$("#myloading").remove(),n.setTitle().setDesc().setImg().setUrl().share()}})});