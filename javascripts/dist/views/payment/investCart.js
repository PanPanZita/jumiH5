define(["jumi","limit","getPara","isLogin","isLoginwx","wx","vue","vueTouch","md5","weixin"],function(a,t,e,s,n,o,i,d,r,l){i.use(d);var c=localStorage.getItem("token"),u=e.get(),m=u.itemid,p=u.gearId,f=u.address_id?u.address_id:0,g={addressId:f,requestSource:"WAP",gearId:p,token:c};s(function(){$.ajax({url:"/needLogin/buy/getBuyOrderDetail",type:"post",dataType:"json",data:g,success:function(e){"0000"==e.code&&new i({el:"body",components:{"my-cart":{template:"#cartTemplate",data:function(){return{data:e.data,isHongBao:1==e.data.isHongBao,num:1,total:0,realtotal:0,canUseHongbao:0,remark:"",paypassword:"",investBillId:"",transId:"",flag:!0}},compiled:function(){var a=this;a.total=a.data.invPrice*a.num,a.canUseHongbao=Math.floor(a.data.hongBaoRate/1e3*a.data.invPrice*a.num),a.canUseHongbao>a.data.hongbaoBalance&&(a.canUseHongbao=a.data.hongbaoBalance),a.realtotal=a.total-a.canUseHongbao,a.realtotal=a.total-a.data.canUseHongbao},methods:{toLink:function(){var a=this,t=a.data.costType;location.href="/h5/views/invest/investCartAddress.html?itemid="+m+"&gearId="+p+"&costType="+t},count:function(){var a=this;a.total=a.data.invPrice*a.num,a.canUseHongbao=Math.floor(a.data.hongBaoRate/1e3*a.data.invPrice*a.num),a.canUseHongbao>a.data.hongbaoBalance&&(a.canUseHongbao=a.data.hongbaoBalance),a.isHongBao?a.realtotal=a.total-a.canUseHongbao:a.realtotal=a.total},add:function(){var t=this,e=99,s=99,n=99;return 1==t.data.isLimitUser&&(s=t.data.limitUser-t.data.supportCount),1==t.data.isCountLimit&&(n=t.data.limitCount-t.data.singleSupportCount),e=s>n?n:s,1==t.data.isLimitUser&&1==t.data.isCountLimit&&t.num>=e&&s<n?void a.tips("聚小米提醒您，该档位的剩余的库存不足～"):1==t.data.isLimitUser&&1==t.data.isCountLimit&&t.num>=e&&s>n?void a.tips("聚小米提醒您，您限购的份额已经不足～"):1==t.data.isLimitUser&&t.num>=e?void a.tips("聚小米提醒您，该档位的剩余的库存不足～"):1==t.data.isCountLimit&&t.num>=e?void a.tips("聚小米提醒您，您限购的份额已经不足～"):(++t.num,void t.count())},del:function(){var t=this;return t.num<=1?void a.tips("聚小米提醒您，购买数量不能低于1份~"):(--t.num,void t.count())},onoff:function(){var a=this;a.isHongBao=!a.isHongBao,a.count()},resetpayStatus:function(){var a=this,t=$(".fake input");a.paypassword="",$(".active").css("left","0px");for(var e=a.paypassword.trim(),s=e.length,n=0;n<s;n++)t.eq(n).val(e[n]),t.eq(n).next().length&&$(".active").css("left",t.eq(n+1).offset().left-t.eq(0).offset().left-parseInt($(".wrap").css("padding-left"))+"px");t.each(function(a,t){a>=s&&$(this).val("")})},next:function(){var t=this;t.resetpayStatus();var e=t.data.jmAddress?t.data.jmAddress.id:0,s=t.remark?t.remark:"",n=t.isHongBao?1:0,o={gearId:p,invNum:t.num,addressId:e,remark:s,isUseHongBao:n,payChannel:"00",token:c,requestSource:"WAP"};$.ajax({type:"post",url:"/needLogin/buy/validateBuy",data:o,dataType:"json",success:function(e){if("0000"==e.code){if(t.investBillId=e.data.investBillId,t.transId=e.data.transId,1==t.data.orderType&&!t.data.jmAddress)return void a.tips("请选择一个地址！");1==e.data.isNeedBindcard?location.href="/h5/views/account/settings/bankcardToBindAndCashout.html":0==e.data.isNeedRecharge?location.href="/h5/views/account/assets/recharge.html":a.alert({skin:"ui-dialog-paypwd",title:"请输入6位数字支付密码",content:document.getElementById("phonecodeWrap"),button:[{value:"忘记密码？",callback:function(){location.href="/h5/views/account/settings/forgetPaypwd.html"}}]})}else a.tips(e.msg)}})},inputpwdKeyup:function(){var t=this,e=t.data.jmAddress?t.data.jmAddress.id:0,s=t.remark?t.remark:"",n=t.isHongBao?1:0,o=/^[0-9]*$/,i=$(".fake input");if(t.paypassword||$(".active").css("left","0px"),o.test(t.paypassword)){for(var d=t.paypassword.trim(),l=d.length,u=0;u<l;u++)i.eq(u).val(d[u]),i.eq(u).next().length&&$(".active").css("left",i.eq(u+1).offset().left-i.eq(0).offset().left-parseInt($(".wrap").css("padding-left"))+"px");if(i.each(function(a,t){a>=l&&$(this).val("")}),6==l){$("#real").attr("disabled","disabled");var f={transId:t.transId,investBillId:t.investBillId,addressId:e,gearId:p,invNum:t.num,isUseHongBao:n,payChannel:"00",payPassword:r(t.paypassword).toLocaleUpperCase(),remark:s,requestSource:"WAP",token:c};t.flag&&$.ajax({url:"/needLogin/buy/toPay",type:"post",dataType:"json",data:f,async:!1,success:function(e){t.flag=!1,"0000"==e.code?location.href="/h5/views/invest/investSuccess.html?itemid="+m+"&investBillId="+e.data.investBillId:"1059"==e.code?(setTimeout(function(){$("#real").removeAttr("disabled","disabled")},1e3),t.flag=!0,a.tips(e.msg),t.resetpayStatus(),document.getElementById("real").focus()):location.href="/h5/views/invest/investFail.html?errorMessage="+e.msg+"&itemid="+m}})}}else a.tips("请输入6位数字支付密码"),t.resetpayStatus()}}}},ready:function(){$("#myloading").remove(),t({dom:"[data-remark]",numDom:"[data-limitnumber]",max:150}),l.setTitle().setDesc().setImg().setUrl().share()}})}})});var v=location.href.split("&code=")[0],h=location.href.split("&code=")[1];if(h){var y=h.split("&state=")[0];n(y,v)}});