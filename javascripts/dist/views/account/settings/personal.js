define(["jumi","nav","touch","isLogin","isLoginwx","vue","weixin"],function(t,e,n,a,o,i,c){var s=localStorage.getItem("token"),r={token:s,requestSource:"WAP"};a(function(){$.ajax({url:"/userCenter/setting/userList",type:"post",dataType:"json",data:r,success:function(a){"0000"==a.code&&new i({el:"body",components:{"my-personal":{template:"#personalTemplate",data:function(){return{data:a.data}}}},ready:function(){e.setActiveNav("account"),$("#myloading").remove();var a,o,i,r,l,u=window.innerWidth,d=window.innerHeight;$(document).on("change","#myfile",function(e){var c=new FileReader,s=e.target.files[0];return s.type.match("image.*")?(c.onload=function(t){return function(e){$("#upload-select").show(),$("#upload-select-img").css({height:d}),$("#mask").css({width:u,height:u,top:(d-u)/2});var c=new Image,s=new Image;s.src=e.target.result,s.onload=function(){var e=s.width,n=s.height,a=e/n,o=640,i=parseInt(o/a),r=document.getElementById("mycanvas");r.width=o,r.height=i;var l=r.getContext("2d");l.drawImage(s,0,0,e,n,0,0,o,i);var u=r.toDataURL("image/jpeg",.5);c.src=u,c.id="cutimg",c.title=t.name,c.alt="待剪切的图片",$("#pic").html(c)},s.onerror=function(){console.log("onerror:")},c.onload=function(){function t(){var t=s/g;a=(g/2-160-v)*t,o=(f/2-160-y)*t,o=o<=0?0:o,i=320*t,i=i>=s?s:i,r=320*t,r=r<=p?r:p,l=k}function e(){g=T*k,f=b*k,v>=(g-u)/2?v=h=(g-u)/2:v<=-(g-u)/2&&(v=h=-(g-u)/2),f>=u?y>=(f-u)/2?(w=(f-u)/2,y=(f-u)/2):y<=-(f-u)/2&&(w=-(f-u)/2,y=-(f-u)/2):y=w=0,c.style.webkitTransform="translate3d("+v+"px,"+y+"px,0) scale("+k+")",c.style.webkitTransitionDuration="0.25s"}var c=this,s=$(c).width(),p=$(c).height(),m=s/p,g=u,f=g/m,h=0,w=0,v=0,y=0,x=1,k=1,T=g,b=f;$(c).width(g),$(c).height(f),$(c).css({left:0,top:(d-f)/2}),t(),n.on("#upload-select-img","touchstart",function(t){t.preventDefault()}),n.on("#upload-select-img","drag",function(t){h=h||0,w=w||0,v=h+t.x,y=w+t.y,c.style.webkitTransform="translate3d("+v+"px,"+y+"px,0) scale("+k+")",c.style.webkitTransitionDuration="0s"}),n.on("#upload-select-img","dragend",function(n){h+=n.x,w+=n.y,e(),t()}),n.on("#upload-select-img","pinch",function(t){t.scale>=1?(k=t.scale-1,k=x+k):(k=4*(t.scale-1),k=x+k,k<=.1&&(k=.1)),c.style.webkitTransform="translate3d("+v+"px,"+y+"px,0) scale("+k+")",c.style.webkitTransitionDuration="0s"}),n.on("#upload-select-img","pinchend",function(n){k=k>=5?5:k,k=k<=1?1:k,x=k,e(),t()})}}}(s),void c.readAsDataURL(s)):(t.tips("文件格式不正确！"),void $("#myfile").val(""))}),$(document).on("click","#upload-select-next",function(){var e=$("#cutimg").attr("src"),n={image:e,cutx:a,cuty:o,cutw:i,cuth:r,token:s,requestSource:"WAP"};$.ajax({url:"/userCenter/setting/uploadHeadPic",type:"post",data:n,success:function(e){"0000"==e.code&&($("#upload-select").hide(),$("#myfile").val(""),$("#imgShow img").attr("src",e.data.litpicPath),t.tips("上传头像成功！"),location.reload())},error:function(e){t.tips("error")}})}),$(document).on("click","#upload-select-cancel",function(){$("#upload-select").hide(),$("#myfile").val("")}),c.setTitle().setDesc().setImg().setUrl().share()}})}})});var l=location.href.split("?code=")[0],u=location.href.split("?code=")[1];if(u){var d=u.split("&state=")[0];o(d,l)}});