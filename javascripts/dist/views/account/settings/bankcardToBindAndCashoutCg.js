define(["jumi","nav","asyncload","vue","getPara","isLogin","md5","weixin"],function(e,t,a,r,s,n,o,i){var c=(s.get(),localStorage.getItem("token")),d={token:c,requestSource:"WAP"};n(function(){$.ajax({url:"/userCenter/userAccount/initOpenAccountOrBindCard",type:"post",dataType:"json",data:d,success:function(a){"0000"==a.code&&new r({el:"body",data:function(){return{data:a,realname:a.data.realname,idNumber:a.data.idNumber,backcardList:a.data.bankList,bankcard:"",paypassword:"",reservephone:"",phonecode:"",originOrderNo:"",clickstatus:!0}},methods:{highlight:function(){var e=/^\S{0}$/,t=1==$("#bankcard").attr("proving")?1:0,a=1==$("#reservephone").attr("proving")?1:0,r=1==$("#phonecode").attr("proving")?1:0,s=!e.test(this.bankcard)&&!e.test(this.reservephone)&&!e.test(this.phonecode),n=t&&a&&r;s&&n?$(".button-fill.button.disabled").removeClass("disabled"):$(".button-fill.button").addClass("disabled")},supportBankcard:function(){e.alert({title:"支持绑定的银行卡",content:document.getElementById("bankcardListBox"),button:!1})},bankcardKeyup:function(t){var a=/^[\d ]*$/,r="",s="";if(!a.test(this.bankcard))return $("#userpwdreal").attr("proving",0),void e.tips("请输入有效的银行卡号！");for(var n=0;n<this.bankcard.length;n++)s=this.bankcard.substr(n,1),isNaN(s)||" "==s||(r+=s);this.bankcard="";for(var n=0;n<r.length;n++)6==n&&(this.bankcard=this.bankcard+" "),12==n&&(this.bankcard=this.bankcard+" "),this.bankcard=this.bankcard+r.substr(n,1);this.highlight()},bankcardBlur:function(){var t=/[\d ]{17,21}/;return t.test(this.bankcard)?($("#bankcard").attr("proving",1),void this.highlight()):($("#bankcard").attr("proving",0),void e.tips("请输入正确的银行卡号！"))},resetpayStatus:function(){var e=this,t=$(".fake input");e.paypassword="",$(".active").css("left","0px");for(var a=e.paypassword.trim(),r=a.length,s=0;s<r;s++)t.eq(s).val(a[s]),t.eq(s).next().length&&$(".active").css("left",t.eq(s+1).offset().left-t.eq(0).offset().left-parseInt($(".wrap").css("padding-left"))+"px");t.each(function(e,t){e>=r&&$(this).val("")})},inputpwdKeyup:function(){var t=this,a=$(".fake input"),r=/^[0-9]*$/;if(t.paypassword||$(".active").css("left","0px"),r.test(t.paypassword)){for(var s=t.paypassword.trim(),n=s.length,i=0;i<n;i++)a.eq(i).val(s[i]),a.eq(i).next().length&&$(".active").css("left",a.eq(i+1).offset().left-a.eq(0).offset().left-parseInt($(".wrap").css("padding-left"))+"px");if(a.each(function(e,t){e>=n&&$(this).val("")}),6==n){var d=t.bankcard.replace(/[ ]/g,""),p={bankCardId:d,payPassword:o(t.paypassword).toLocaleUpperCase(),confirmPayPassword:o(t.paypassword).toLocaleUpperCase(),requestSource:"WAP",token:c,originOrderNo:t.originOrderNo,phone:t.reservephone,phoneCode:t.phonecode};$.ajax({url:"/userCenter/userAccount/bindCard",type:"post",dataType:"json",data:p,success:function(a){"0000"==a.code?location.href="/h5/views/account/settings/openaccountSuccess.html"+location.search:"1059"==a.code?(e.tips(a.msg),t.resetpayStatus(),document.getElementById("real").focus()):location.href="/h5/views/account/settings/bankcardToBindFail.html?errorMessage="+a.msg+"&"+location.search.substring(1)}})}}else e.tips("请输入6位数字支付密码"),t.resetpayStatus()},reservephoneKeyup:function(){var t=/^[0-9]*$/,a=/^(13|14|15|17|18|19)\d{9}$/,r=this.reservephone.length;if(!t.test(this.reservephone))return void e.tips("手机号码格式不正确！");if(11==r){if(!a.test(this.reservephone))return void e.tips("手机号码格式不正确！");$(".havacode").css("opacity","1"),$(".havacode").removeAttr("disabled","disabled"),$("#reservephone").attr("proving",1)}else $(".havacode").css("opacity","0.5"),$(".havacode").attr("disabled","disabled"),$("#reservephone").attr("proving",0);this.highlight()},phonecodeKeyup:function(){var t=/^[0-9]*$/,a=this.phonecode.length;return t.test(this.phonecode)?(6==a?$("#phonecode").attr("proving",1):$("#phonecode").attr("proving",0),void this.highlight()):($("#phonecode").attr("proving",0),void e.tips("请输入数字！"))},havacode:function(){var t=this;if(t.clickstatus){t.clickstatus=!1;var a=t.bankcard.replace(/[ ]/g,""),r=60,s={realname:t.realname,idNumber:t.idNumber,bankCardId:a,phone:t.reservephone,token:c,requestSource:"WAP"};$.ajax({url:"/userCenter/userAccount/getBankCode",type:"post",dataType:"json",data:s,success:function(a){if("0000"==a.code){var s=setInterval(function(){r--,$(".havacode").html(r+"s"),r<=0&&(clearInterval(s),$(".havacode").html("重新获取"),$(".havacode").css("opacity","1"),$(".havacode").removeAttr("disabled","disabled"))},1e3);t.originOrderNo=a.data.orderNo}else e.tips(a.msg),t.clickstatus=!0}})}},next:function(){var t=this;t.resetpayStatus();t.bankcard.replace(/[ ]/g,"");e.alert({skin:"ui-dialog-paypwd",title:"请输入6位数字支付密码",content:document.getElementById("phonecodeWrap"),button:[{value:"忘记密码？",callback:function(){location.href="/h5/views/account/settings/forgetPaypwd.html"}}]})}},ready:function(){t.setActiveNav("account"),$("#myloading").remove(),$("img.async").asyncload(),i.setTitle().setDesc().setImg().setUrl().share()}})}})})});