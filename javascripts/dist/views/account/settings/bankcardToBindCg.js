define(["jumi","nav","asyncload","vue","getPara","isLogin","md5","weixin"],function(e,t,r,a,s,i,n,o){var d=(s.get(),localStorage.getItem("token")),c={token:d,requestSource:"WAP"};i(function(){$.ajax({url:"/userCenter/userAccount/initOpenAccountOrBindCard",type:"post",dataType:"json",data:c,success:function(r){"0000"==r.code&&new a({el:"body",data:function(){return{realname:"",idNumber:"",bankcard:"",userpwdreal:"",userconfirmpwdreal:"",reservephone:"",phonecode:"",backcardList:r.data.bankList,originOrderNo:"",clickstatus:!0,clickstatuscode:!0}},methods:{highlight:function(){var e=/^\S{0}$/,t=1==$("#idNumber").attr("proving")?1:0,r=1==$("#bankcard").attr("proving")?1:0,a=1==$("#userpwdreal").attr("proving")?1:0,s=1==$("#userconfirmpwdreal").attr("proving")?1:0,i=1==$("#reservephone").attr("proving")?1:0,n=1==$("#phonecode").attr("proving")?1:0,o=!(e.test(this.realname)||e.test(this.idNumber)||e.test(this.bankcard)||e.test(this.userpwdreal)||e.test(this.userconfirmpwdreal)||e.test(this.reservephone)||e.test(this.phonecode)),d=t&&r&&a&&s&&i&&n;o&&d?$(".button-fill.button.disabled").removeClass("disabled"):$(".button-fill.button").addClass("disabled")},supportBankcard:function(){e.alert({title:"支持绑定的银行卡",content:document.getElementById("bankcardListBox"),button:!1})},idNumberBlur:function(){var t=/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/;if(this.idNumber.length>0&&!t.test(this.idNumber))return void e.tips("请输入正确的身份证号！");var r={idNumber:this.idNumber,requestSource:"WAP"};$.ajax({url:"/common/validateIdNumberRepeat",type:"post",dataType:"json",data:r,success:function(t){"0000"==t.code?$("#idNumber").attr("proving",1):"1027"==t.code?e.tips("该身份证号已被注册"):e.tips(t.msg)}}),this.highlight()},bankcardKeyup:function(t){var r=/^[\d ]*$/,a="",s="";if(this.bankcard.length>0&&!r.test(this.bankcard))return $("#userpwdreal").attr("proving",0),void e.tips("请输入有效的银行卡号！");for(var i=0;i<this.bankcard.length;i++)s=this.bankcard.substr(i,1),isNaN(s)||" "==s||(a+=s);this.bankcard="";for(var i=0;i<a.length;i++)6==i&&(this.bankcard=this.bankcard+" "),12==i&&(this.bankcard=this.bankcard+" "),this.bankcard=this.bankcard+a.substr(i,1);this.highlight()},bankcardBlur:function(){var t=/[\d ]{17,21}/;return this.bankcard.length>0&&!t.test(this.bankcard)?($("#bankcard").attr("proving",0),void e.tips("请输入正确的银行卡号！")):($("#bankcard").attr("proving",1),void this.highlight())},userpwdrealKeyup:function(){var t=/^[0-9]*$/;return t.test(this.userpwdreal)?(6==this.userpwdreal.length?$("#userpwdreal").attr("proving",1):$("#userpwdreal").attr("proving",0),void this.highlight()):($("#userpwdreal").attr("proving",0),void e.tips("支付密码应为6位数字"))},userconfirmpwdrealKeyup:function(){var t=this.userconfirmpwdreal.length;6==t?this.userconfirmpwdreal==this.userpwdreal?$("#userconfirmpwdreal").attr("proving",1):($("#userconfirmpwdreal").attr("proving",0),e.tips("两次密码输入不一致")):$("#userconfirmpwdreal").attr("proving",0),this.highlight()},reservephoneKeyup:function(){var t=/^[0-9]*$/,r=/^(13|14|15|17|18|19)\d{9}$/,a=this.reservephone.length;if(!t.test(this.reservephone))return void e.tips("手机号码格式不正确！");if(11==a){if(!r.test(this.reservephone))return void e.tips("手机号码格式不正确！");$(".havacode").css("opacity","1"),$(".havacode").removeAttr("disabled","disabled"),$("#reservephone").attr("proving",1)}else $(".havacode").css("opacity","0.5"),$(".havacode").attr("disabled","disabled"),$("#reservephone").attr("proving",0);this.highlight()},phonecodeKeyup:function(){var t=/^[0-9]*$/,r=this.phonecode.length;return t.test(this.phonecode)?(6==r?$("#phonecode").attr("proving",1):$("#phonecode").attr("proving",0),void this.highlight()):($("#phonecode").attr("proving",0),void e.tips("请输入数字！"))},havacode:function(){var t=60,r=this;if(r.clickstatuscode){r.clickstatuscode=!1,$(".havacode").css("opacity","0.5"),$(".havacode").attr("disabled","disabled");var a=this.bankcard.replace(/[ ]/g,""),s={realname:r.realname,idNumber:r.idNumber,bankCardId:a,phone:r.reservephone,token:d,requestSource:"WAP"};$.ajax({url:"/userCenter/userAccount/getBankCode",type:"post",dataType:"json",data:s,success:function(a){if("0000"==a.code){var s=setInterval(function(){t--,$(".havacode").html(t+"s"),t<=0&&(clearInterval(s),$(".havacode").html("重新获取"),$(".havacode").css("opacity","1"),$(".havacode").removeAttr("disabled","disabled"))},1e3);r.originOrderNo=a.data.orderNo}else e.tips(a.msg),r.clickstatuscode=!0}})}},next:function(){var e=this;if(e.clickstatus){e.clickstatus=!1;var t=e.bankcard.replace(/[ ]/g,""),r={realname:e.realname,idNumber:e.idNumber,bankCardId:t,phone:e.reservephone,payPassword:n(e.userpwdreal).toLocaleUpperCase(),confirmPayPassword:n(e.userconfirmpwdreal).toLocaleUpperCase(),phoneCode:e.phonecode,originOrderNo:e.originOrderNo,token:d,requestSource:"WAP"};$.ajax({url:"/userCenter/userAccount/openAccount",type:"post",dataType:"json",data:r,success:function(e){"0000"==e.code?location.href="/h5/views/account/settings/openaccountSuccess.html"+location.search:location.href="/h5/views/account/settings/openaccountFail.html?errorMessage="+e.msg+"&"+location.search.substring(1)}})}}},ready:function(){t.setActiveNav("account"),$("#myloading").remove(),$("img.async").asyncload(),o.setTitle().setDesc().setImg().setUrl().share()}})}})})});