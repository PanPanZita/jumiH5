define(["jumi","vue","getPara","weixin","api","md5"],function(e,t,o,i,a,n){var s=o.get(),c=location.href,r={userIdCode:s.u,requestSource:"WAP"};$.ajax({url:"/common/initInviteRegister",type:"post",dataType:"json",data:r,success:function(o){"0000"==o.code?null!=o.data&&new t({el:"body",components:{"my-redpacket":{template:"#redpacketTemplate",data:function(){return{data:o.data,invitePhone:o.data.userPhone,setIntervalID:"",isHide:!1,rewardValue:o.data.rewardValue,clickstatus:!0,phone:"",phoneCode:"",countTime:60,setIntervalCode:null,sliderSuccess:!1,isShowHide:!0,flagVoice:!0,isShowHideRegister:!0}},watch:{phone:function(e,t){var o=/^1\d{10}$/,i=/^\d{4}$/,a=o.test(this.phone),n=i.test(this.phoneCode);a&&n?this.isShowHideRegister=!1:this.isShowHideRegister=!0},phoneCode:function(e,t){var o=/^1\d{10}$/,i=/^\d{4}$/,a=o.test(this.phone),n=i.test(this.phoneCode);a&&n?this.isShowHideRegister=!1:this.isShowHideRegister=!0}},methods:{inputPhoneKeyup:function(){var t=this,o=/^1\d{10}$/;if(o.test(t.phone)&&!t.sliderSuccess){t.isShowHide=!1;var i={phone:t.phone,requestSource:"WAP"};$.ajax({url:"/common/validatePhoneIsExist",type:"post",dataType:"json",data:i,success:function(o){"0000"==o.code?o.data.result&&e.alert({skin:"ui-dialog-redpacket",content:"聚小米提醒您，<br>该红包只能送给聚米新成员哦~",button:[{value:"取消",callback:function(){t.phone=""}},{value:"我也要邀请",callback:function(){location.href="/h5/views/account/invite/invite.html"}}]}):e.tips(o.msg)}})}else t.isShowHide=!0},getVoicecode:function(){var t=this;if(t.flagVoice){var o={phone:t.phone,requestSource:"WAP"};t.flagVoice=!1,$.ajax({url:"/common/authcode/voiceCode",type:"get",datatype:"json",data:o,success:function(o){"0000"==o.code?e.tips("语音验证码发送成功，请注意接听来电..."):e.tips(o.msg),setTimeout(function(){t.flagVoice=!0},5e3)}})}},getCode:function(){var t=this;$(".getVoicecode").removeAttr("disabled"),$(".getVoicecode").removeClass("disabled");var o=["FFFF0N00000000005AD9",(new Date).getTime(),Math.random()].join(":"),i=NoCaptcha.init({renderTo:"#sliderNc",appkey:"FFFF0N00000000005AD9",scene:"nc_register_h5",token:o,trans:{key1:"code0"},elementID:["usernameID"],is_Opt:0,language:"cn",timeout:1e4,retryTimes:5,errorTimes:5,inline:!1,apimap:{},bannerHidden:!0,initHidden:!0,callback:function(i){var a={phone:t.phone,scence:"nc_register_h5",sessionId:i.csessionid,sig:i.sig,token:o};$.ajax({url:"/common/authcode/slidValidate",type:"post",datatype:"json",data:a,success:function(o){"0000"==o.code?(e.tips("验证码发送成功，请注意查收..."),clearInterval(t.setIntervalCode),t.sliderSuccess=!0,t.isShowHide=!0,t.setIntervalCode=setInterval(function(){t.countTime--,$(".getCode").html(t.countTime+"s后重新获取验证码"),t.countTime<=0&&(clearInterval(t.setIntervalCode),t.sliderSuccess=!1,t.countTime=60,$(".getCode").html("重新获取"),t.isShowHide=!1)},1e3)):e.tips(o.msg)}})},error:function(e){}});NoCaptcha.setEnabled(!0),i.reset(),NoCaptcha.upLang("cn",{LOADING:"加载中...",SLIDER_LABEL:"请按住滑块，拖动到最右边",CHECK_Y:"验证通过",ERROR_TITLE:"非常抱歉，这出错了...",CHECK_N:"验证未通过",OVERLAY_INFORM:"经检测你当前操作环境存在风险，请输入验证码",TIPS_TITLE:"验证码错误，请重新输入"}),i.show(),t.isShowHide=!0},protocols:function(){var t=$("#protocolBox").children().length;t?e.alert({title:"聚米众筹用户注册服务协议",content:$("#protocolBox").html(),button:[{value:"知道了"}]}):$("#protocolBox").load("/h5/views/common/protocols.html",function(){e.alert({title:"聚米众筹用户注册服务协议",content:$("#protocolBox").html(),button:[{value:"知道了"}]})})},toReceive:function(){var t=this;if(t.clickstatus){t.clickstatus=!1;var o=(new Date).getTime(),i={sourceType:1,registerPhone:t.phone,phoneCode:t.phoneCode,invitePhone:t.invitePhone,timeToken:o,requestSource:"WAP"};$.ajax({url:"/register/register",type:"post",dataType:"json",data:i,success:function(o){"0000"==o.code?(t.isHide=!0,localStorage.setItem("token",o.data.token)):(e.tips(o.msg),t.clickstatus=!0)}})}},toUse:function(){location.href="/h5/views/main/index.html"}}}},ready:function(){var e=this;if($("#myloading").remove(),"ios"==localStorage.fromapp){var t={title:e.$children[0].data.shareTitle,desc:e.$children[0].data.shareContent,img:e.$children[0].data.shareImage,url:c};window.webkit.messageHandlers.share.postMessage(t)}else if("android"==localStorage.fromapp){var t={title:e.$children[0].data.shareTitle,desc:e.$children[0].data.shareContent,img:e.$children[0].data.shareImage,url:c};window.Android.callAndroidAction("0",JSON.stringify(t))}else i.setTitle(e.$children[0].data.shareTitle).setDesc(e.$children[0].data.shareContent).setImg(e.$children[0].data.shareImage).setUrl(c).share()}}):e.tips(o.msg)}})});